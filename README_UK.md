# autopif

[English](./README.md) | **Українська** | [Русский](./README_RU.md)

Полегшений форк [daboynb/playcurl](https://github.com/daboynb/PlayIntegrityNEXT/tree/main/playcurl), який виконує одну задачу: кожні 25 хвилин отримує* файл pif.json і порівнює його з вашим поточним файлом `custom.pif.json` або `pif.json`. Якщо ваш файл відрізняється або відсутній, він замінює його і зупиняє сервіси DroidGuard та Google Гаманця. Якщо файли ідентичні або сталася помилка (наприклад, немає інтернет-з'єднання або не вдалося отримати файл), він нічого не робить у цій ітерації (спробі). Цей модуль призначений для використання з модулем [osm0sis/PlayIntegrityFork](https://github.com/osm0sis/PlayIntegrityFork) (за моїм уподобанням) або з модулем [chiteroman/PlayIntegrityFix](https://github.com/chiteroman/PlayIntegrityFix).

<details>
<summary>* Про отримання pif.json</summary>

Існує два варіанти цього модуля:

**Варіант fetch**:  
Завантажує файл з [pifsync/pif.json](https://github.com/vladrevers/pifsync/blob/main/pif.json).
- **Плюс**: Використовує менше мережевого трафіку і легший.
- **Мінус**: Новий pif.json може бути доступний з невеликою затримкою (приблизно 10± хвилин).

**Варіант selfgen**:  
Генерує файл на пристрої, завантажуючи та витягуючи інформацію з останнього [XiaomiEUModule.apk](https://sourceforge.net/projects/xiaomi-eu-multilang-miui-roms/files/xiaomi.eu/Xiaomi.eu-app/) від xiaomi.eu.
- **Плюс**: Новий pif.json доступний без затримки.
- **Мінус**: Використовує трохи більше мережевого трафіку і потребує бінарної бібліотеки aapt, що збільшує розмір встановленого модуля на 1,4 МБ.
- **Оптимізація**: Кешує останній pif.json та посилання на apk, тому завантаження та витягування інформації з apk відбувається лише за необхідності (при оновленні).
</details>

Інтервал в 25 хвилин можна змінити, будь ласка, дивіться в розділах [Налаштування](#Налаштування) і [Примітка](#Примітка).

## Встановлення

1. Якщо модуль [osm0sis/PlayIntegrityFork](https://github.com/osm0sis/PlayIntegrityFork/releases/latest) або [chiteroman/PlayIntegrityFix](https://github.com/chiteroman/PlayIntegrityFix/releases/latest) ще не встановлений, встановіть його (перезавантажувати пристрій поки що не потрібно).
2. Встановіть цей модуль [autopif](https://github.com/vladrevers/autopif/releases/latest).
3. Перезавантажте пристрій. Якщо ви хочете побачити результати одразу, переконайтеся, що ваше інтернет-з'єднання увімкнене **перед** перезавантаженням.

## Налаштування

У папці встановленого модуля autopif (`/data/adb/modules/autopif`), ви можете знайти та редагувати файл `config.prop` з наступними налаштуваннями:

- `update_interval_minutes` - інтервал у хвилинах для перевірки оновлень (за замовчуванням: 25)
- `pif_json_url` - пряме посилання для оновлення PIF JSON файлу (за замовчуванням: https://raw.githubusercontent.com/vladrevers/pifsync/main/pif.json)
- `logging` - увімкнення/вимкнення логування в `/storage/emulated/0/autopif_log.txt` (за замовчуванням: on)
- `replace_logging` - увімкнення/вимкнення логування заміни вмісту PIF файлу (до/після) в `/storage/emulated/0/autopif_replace_log.txt` (за замовчуванням: off)
- `turn_spoof_signature` - увімкнення/вимкнення додавання параметра підміни підпису в PIF файлі (за замовчуванням: off, крім випадку коли підпис вашої прошивки тестовий)
- `turn_spoof_vendingSDK` - увімкнення/вимкнення додавання параметра підміни vendingSDK в PIF файлі (за замовчуванням: on для Android 13+ та off для старіших версій). Може викликати проблеми в Play Store, детальніше у [примітках до релізу](https://github.com/vladrevers/autopif/releases/tag/v1.9)

## Ручний запуск

Ви можете виконати одноразову перевірку двома способами:
1. На Magisk v28+:
   - Відкрийте Magisk → Modules
   - Натисніть кнопку "Action" біля autopif
2. Використовуючи команду в терміналі:
```shell
cd /data/adb && ./magisk/busybox ash -o standalone ./modules/autopif/service.sh -o
```

Обидва методи запустять скрипт один раз з виведенням результатів у консоль. Це корисно для швидкого оновлення поточного PIF файлу та для відлагодження.

## Примітка

Після встановлення я рекомендую перевірити файл `autopif_log.txt` у внутрішньому сховищі через 12-24 години звичного використання пристрою. Я помітив, що на моєму пристрої з Android 14 скрипт призупиняється Magisk-ом або самим Android-ом, коли екран вимкнений протягом тривалого періоду, а інші додатки при цьому не виконують фонові завдання (наприклад, не грає музика). Скрипт автоматично продовжує роботу, після увімкнення екрану. Якщо у вас виникла подібна ситуація, можливо, варто зменшити інтервал перевірки з 25 хвилин до, наприклад, 20 хвилин. Проте залишити значення в 25 хвилин теж нормально. З іншого боку, якщо скрипт виконується точно за заданим інтервалом (наприклад, на старішій версії Android), можливо, варто збільшити інтервал з 25 хвилин до, наприклад, 45 хвилин. Встановлення занадто короткого інтервалу, особливо менш ніж 5 хвилин, не рекомендується. Після перевірки ви можете вимкнути логування і видалити файл журналу. Інструкції щодо зміни інтервалу перевірки та вимкнення логування дивіться у розділі [Налаштування](#Налаштування).