# autopif

[English](./README.md) | [Українська](./README_UK.md) | **Русский**

Облегченный форк [daboynb/playcurl](https://github.com/daboynb/PlayIntegrityNEXT/tree/main/playcurl), который выполняет одну задачу: каждые 25 минут получает* файл pif.json и сравнивает его с вашим текущим файлом `custom.pif.json` или `pif.json`. Если ваш файл отличается или отсутствует, он заменяет его и останавливает службы DroidGuard и Google Кошелька. Если файлы идентичны или произошла ошибка (например, нет интернет-соединения или не удалось получить файл), он ничего не делает в этой итерации (попытке). Этот модуль предназначен для использования с модулем [osm0sis/PlayIntegrityFork](https://github.com/osm0sis/PlayIntegrityFork) (по моему предпочтению) или с модулем [chiteroman/PlayIntegrityFix](https://github.com/chiteroman/PlayIntegrityFix).

<details>
<summary>* О получении pif.json</summary>

Существует два варианта этого модуля:

**Вариант fetch**:  
Скачивает файл с [pifsync/pif.json](https://github.com/vladrevers/pifsync/blob/main/pif.json).
- **Плюс**: Использует меньше сетевого трафика и легче.
- **Минус**: Новый pif.json может быть доступен с небольшой задержкой (примерно 10± минут).

**Вариант selfgen**:  
Генерирует файл на устройстве, скачивая и извлекая информацию из последнего [XiaomiEUModule.apk](https://sourceforge.net/projects/xiaomi-eu-multilang-miui-roms/files/xiaomi.eu/Xiaomi.eu-app/) от xiaomi.eu.
- **Плюс**: Новый pif.json доступен без задержки.
- **Минус**: Использует немного больше сетевого трафика и требует бинарную библиотеку aapt, что увеличивает размер установленного модуля на 1,4 МБ.
- **Оптимизация**: Кэширует последний pif.json и ссылку на apk, поэтому скачивание и извлечение информации из apk происходит только при необходимости (при обновлении).
</details>

Интервал в 25 минут можно изменить, смотрите в разделах [Настройки](#Настройки) и [Примечание](#Примечание).

## Установка

1. Если модуль [osm0sis/PlayIntegrityFork](https://github.com/osm0sis/PlayIntegrityFork/releases/latest) или [chiteroman/PlayIntegrityFix](https://github.com/chiteroman/PlayIntegrityFix/releases/latest) еще не установлен, установите его (перезагружать устройство пока что не нужно).
2. Установите этот модуль [autopif](https://github.com/vladrevers/autopif/releases/latest).
3. Перезагрузите устройство. Если вы хотите увидеть результаты сразу, убедитесь, что ваше интернет-соединение включено **до** перезагрузки.

## Настройки

В папке установленного модуля autopif (`/data/adb/modules/autopif`), вы можете найти и редактировать файл `config.prop` со следующими настройками:

- `update_interval_minutes` - интервал в минутах для проверки обновлений (по умолчанию: 25)
- `pif_json_url` - прямая ссылка для обновления PIF JSON файла (по умолчанию: https://raw.githubusercontent.com/vladrevers/pifsync/main/pif.json)
- `logging` - включение/выключение логирования в `/storage/emulated/0/autopif_log.txt` (по умолчанию: on)
- `replace_logging` - включение/выключение логирования замены содержимого PIF файла (до/после) в `/storage/emulated/0/autopif_replace_log.txt` (по умолчанию: off)
- `turn_spoof_signature` - включение/выключение добавления параметра подмены подписи в PIF файле (по умолчанию: off, кроме случая когда подпись вашей прошивки тестовая)
- `turn_spoof_vendingSDK` - включение/выключение добавления параметра подмены vendingSDK в PIF файле (по умолчанию: on для Android 13+ и off для более старых версий). Может вызывать проблемы в Play Store, подробности в [примечаниях к релизу](https://github.com/vladrevers/autopif/releases/tag/v1.9)

## Ручной запуск

Вы можете выполнить одноразовую проверку двумя способами:
1. На Magisk v28+:
   - Откройте Magisk → Modules
   - Нажмите кнопку "Action" возле autopif
2. Используя команду в терминале:
```shell
cd /data/adb && ./magisk/busybox ash -o standalone ./modules/autopif/service.sh -o
```

Оба метода запустят скрипт один раз с выводом результатов в консоль. Это полезно для быстрого обновления текущего PIF файла и для отладки.

## Примечание

После установки я рекомендую проверить файл `autopif_log.txt` во внутреннем хранилище через 12-24 часа привычного использования устройства. Я заметил, что на моем устройстве с Android 14, скрипт приостанавливается Magisk-ом или самим Android-ом, когда экран долго выключен и другие приложения при этом не выполняют фоновые задачи (например, не играет музыка). Скрипт автоматически продолжает работу, после включения экрана. Если у вас возникла похожая ситуация, возможно, стоит уменьшить интервал проверки с 25 минут до, например, 20 минут. Однако оставить значения в 25 минут тоже нормально. С другой стороны, если скрипт выполняется точно по заданному интервалу (например, на более старой версии Android), возможно, стоит увеличить интервал с 25 минут до, например, 45 минут. Устанавливать слишком короткий интервал, особенно менее 5 минут, не рекомендуется. После проверки вы можете отключить логирование и удалить файл лога. Инструкции по изменению интервала проверки и отключению логирования смотрите в разделе [Настройки](#Настройки).

**Объявление (01.01.2025, только для варианта Fetch)**  
В последнее время публичные источники в основном используют отпечатки из бета-версий прошивок Google Pixel. Поэтому вы можете изменить параметр pif_json_url в файле config.prop, заменив pif.json в стандартной ссылке на pif_beta.json: https://raw.githubusercontent.com/vladrevers/pifsync/main/pif_beta.json

Также рекомендуется значительно увеличить интервал проверки обновлений (update_interval_minutes), например, до 6 часов (360 минут). Такая настройка, как правило, обеспечивает более стабильную работу (например, меньше вероятность сбоев RCS), при условии отсутствия неожиданных изменений или "сюрпризов" от Google.