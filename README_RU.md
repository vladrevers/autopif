# autopif

[English](./README.md) | [Українська](./README_UK.md) | **Русский**

Облегченный форк [daboynb/playcurl](https://github.com/daboynb/PlayIntegrityNEXT/tree/main/playcurl), который выполняет одну задачу: каждые 25 минут скачивает файл [autojson/pif.json](https://github.com/daboynb/autojson/blob/main/chiteroman.json) и сравнивает его с вашим текущим файлом `custom.pif.json` или `pif.json`. Если ваш файл отличается или отсутствует, он заменяет его, останавливает службы GMS/Wallet и очищает их кэш. Если файлы идентичны или произошла ошибка (например, нет интернет-соединения или не удалось скачать файл), он ничего не делает в этой итерации (попытке). Этот модуль предназначен для использования с модулем [osm0sis/PlayIntegrityFork](https://github.com/osm0sis/PlayIntegrityFork) (по моему предпочтению) или с модулем [chiteroman/PlayIntegrityFix](https://github.com/chiteroman/PlayIntegrityFix).

Интервал в 25 минут можно изменить, смотрите в разделах [Настройки](#Настройки) и [Примечание](#Примечание).

## Установка

1. Если модуль [osm0sis/PlayIntegrityFork](https://github.com/osm0sis/PlayIntegrityFork/releases/latest) или [chiteroman/PlayIntegrityFix](https://github.com/chiteroman/PlayIntegrityFix/releases/latest) еще не установлен, установите его (перезагружать устройство пока что не нужно).

2. Установите этот модуль [autopif](https://github.com/vladrevers/autopif/releases/latest).

3. Перезагрузите устройство. Если вы хотите увидеть результаты сразу, убедитесь, что ваше интернет-соединение включено **до** перезагрузки.

## Настройки

Вы можете найти или создать следующие файлы для настройки, в папке установленного модуля autopif (`/data/adb/modules/autopif`) или внутри ZIP-файла модуля перед установкой:

- `minutes.txt` (содержит только целое число, указывающее интервал в минутах для проверки обновлений, по умолчанию 25)
- `pif_json_url.txt` (позволяет переопределить прямую ссылку для обновления PIF JSON файла. По умолчанию отсутствует и используется URL по умолчанию)
- `log_file_on` (если этот файл существует, лог будет записан в `/storage/emulated/0/autopif_log.txt`. По умолчанию присутствует, удалите этот файл, если вам лог не нужен)
- `replace_log_file_on` (если этот файл существует, лог замены содержимого PIF файла (до/после) будет записываться в `/storage/emulated/0/autopif_replace_log.txt`. По умолчанию отсутствует, создайте этот файл, если вам нужно логирование замены содержимого)

## Ручной запуск

Вы можете выполнить одноразовую проверку вручную, используя следующую команду в терминале:

```shell
cd /data/adb && ./magisk/busybox ash ./modules/autopif/service.sh -o
```

Эта команда запустит скрипт один раз с выводом результатов в консоль. Это полезно для быстрого обновления текущего PIF файла и для отладки.

## Примечание

После установки я рекомендую проверить файл `autopif_log.txt` во внутреннем хранилище через 12-24 часа привычного использования устройства. Я заметил, что на моем устройстве с Android 14, скрипт приостанавливается Magisk-ом или самим Android-ом, когда экран долго выключен и другие приложения при этом не выполняют фоновые задачи (например, не играет музыка). Скрипт автоматически продолжает работу, после включения экрана. Если у вас возникла похожая ситуация, возможно, стоит уменьшить интервал проверки с 25 минут до, например, 20 минут. Однако оставить значения в 25 минут тоже нормально. С другой стороны, если скрипт выполняется точно по заданному интервалу (например, на более старой версии Android), возможно, стоит увеличить интервал с 25 минут до, например, 45 минут. Устанавливать слишком короткий интервал, особенно менее 10 минут, не рекомендуется, так как файл [autojson/pif.json](https://github.com/daboynb/autojson/blob/main/chiteroman.json) на сервере обновляется раз в час. После проверки вы можете отключить логирование и удалить файл лога. Инструкции по изменению интервала проверки и отключению логирования смотрите в разделе [Настройки](#Настройки).